{{ define "main" }}
  {{ .Scratch.Set "scope" "list" }}

  {{/* Hero */}}
  {{ if site.Params.list.showHero | default false }}
    {{ $heroStyle := print "hero/" site.Params.list.heroStyle ".html" }}
    {{ if templates.Exists (printf "partials/%s" $heroStyle) }}
      {{ partial $heroStyle . }}
    {{ else }}
      {{ partial "hero/basic.html" . }}
    {{ end }}
  {{ end }}

  <div class="page-container max-w-prose-xl mx-auto timeline-page">
    {{/* Header */}}
    <header>
      {{ if .Params.showBreadcrumbs | default (site.Params.list.showBreadcrumbs | default false) }}
        {{ partial "breadcrumbs.html" . }}
      {{ end }}
      <div>
        <h1 class="text-4xl font-extrabold text-neutral-900 dark:text-neutral">
          {{ site.Params.posts.listTitle | default .Title }}
        </h1>
        <div class="mt-1 mb-2 text-base text-neutral-500 dark:text-neutral-400 print:hidden">
          {{ partial "article-meta/list.html" (dict "context" . "scope" "single") }}
        </div>
      </div>

      {{/* Page view tracking script */}}
      {{ $translations := .AllTranslations }}
      {{ with .File }}
        {{ $path := .Path }}
        {{ range $translations }}
          {{ $lang := print "." .Lang ".md" }}
          {{ $path = replace $path $lang ".md" }}
        {{ end }}
        {{ $jsPage := resources.Get "js/page.js" }}
        {{ $jsPage = $jsPage | resources.Minify | resources.Fingerprint (site.Params.fingerprintAlgorithm | default "sha512") }}
        <script
          type="text/javascript"
          src="{{ $jsPage.RelPermalink }}"
          integrity="{{ $jsPage.Data.Integrity }}"
          data-oid="views_{{ $path }}"
          data-oid-likes="likes_{{ $path }}"></script>
      {{ end }}
    </header>

    {{/* Description content */}}
    <section class="mt-0 prose flex max-w-full flex-col dark:prose-invert lg:flex-row">
      <div class="min-w-0 min-h-0 max-w-prose">
        {{ .Content }}
      </div>
    </section>

    {{/* Article list */}}
    {{ if gt .Pages 0 }}
      {{ $cardView := .Params.cardView | default (site.Params.list.cardView | default false) }}
      {{ $cardViewScreenWidth := .Params.cardViewScreenWidth | default (site.Params.list.cardViewScreenWidth | default false) }}
      {{ $groupByYear := .Params.groupByYear | default (site.Params.list.groupByYear | default false) }}
      {{ $orderByWeight := .Params.orderByWeight | default (site.Params.list.orderByWeight | default false) }}
      {{ $groupByYear = and (not $orderByWeight) $groupByYear }}

      {{ if not $cardView }}
        {{/* Timeline view */}}
        <section class="w-full py-8">
          <ol class="timeline-container">
            {{ if $orderByWeight }}
              {{ range $index, $page := (.Paginate (.Pages.ByWeight)).Pages }}
                <li class="timeline-item" style="--timeline-index: {{ add $index 1 }};">
                  <time datetime="{{ $page.Date.Format "2006-01-02" }}" class="text-base text-neutral-600 dark:text-neutral-400 font-mono text-right pr-1 pt-1">
                    {{ $page.Date.Format "01-02" }}
                  </time>
                  <div class="flex items-start justify-center pt-1">
                    <span class="timeline-dot" aria-hidden="true"></span>
                  </div>
                  <div class="min-w-0">
                    {{ partial "article-link/simple.html" $page }}
                  </div>
                </li>
              {{ end }}
            {{ else }}
              {{ range $group := (.Paginate (.Pages.GroupByDate "2006")).PageGroups }}
                {{ if $groupByYear }}
                  <li class="timeline-year">
                    <time datetime="{{ $group.Key }}" class="text-2xl font-bold text-neutral-700 dark:text-neutral-300 font-mono text-right pr-1">
                      {{ $group.Key }}
                    </time>
                    <div class="flex items-center justify-center">
                      <span class="timeline-year-dot" aria-hidden="true"></span>
                    </div>
                    <div></div>
                  </li>
                {{ end }}
                {{ range $index, $page := $group.Pages }}
                  <li class="timeline-item" style="--timeline-index: {{ add $index 1 }};">
                    <time datetime="{{ $page.Date.Format "2006-01-02" }}" class="text-base text-neutral-600 dark:text-neutral-400 font-mono text-right pr-1 pt-1">
                      {{ $page.Date.Format "01-02" }}
                    </time>
                    <div class="flex items-start justify-center pt-1">
                      <span class="timeline-dot" aria-hidden="true"></span>
                    </div>
                    <div class="min-w-0">
                      {{ partial "article-link/simple.html" $page }}
                    </div>
                  </li>
                {{ end }}
              {{ end }}
            {{ end }}
          </ol>
        </section>

      {{ else }}
        {{/* Card view */}}
        {{ if $groupByYear }}
          {{ range (.Paginate (.Pages.GroupByDate "2006")).PageGroups }}
            {{ if $cardViewScreenWidth }}
              <div class="relative w-screen max-w-[1600px] px-[30px] start-[calc(max(-50vw,-800px)+50%)]">
            {{ end }}
            <h2 class="mt-12 mb-3 text-2xl font-bold text-neutral-700 first:mt-8 dark:text-neutral-300">
              {{ .Key }}
            </h2>
            <section class="w-full grid gap-4 sm:grid-cols-2 md:grid-cols-3 {{ if $cardViewScreenWidth }}xl:grid-cols-4 2xl:grid-cols-5{{ end }}">
              {{ range .Pages }}
                {{ partial "article-link/card.html" . }}
              {{ end }}
            </section>
            {{ if $cardViewScreenWidth }}</div>{{ end }}
          {{ end }}
        {{ else }}
          {{ if $cardViewScreenWidth }}
            <div class="relative w-screen max-w-[1600px] px-[30px] start-[calc(max(-50vw,-800px)+50%)]">
              <section class="w-full grid gap-4 sm:grid-cols-2 md:grid-cols-3 xl:grid-cols-4 2xl:grid-cols-5">
          {{ else }}
            <section class="w-full grid gap-4 sm:grid-cols-2 md:grid-cols-3">
          {{ end }}
          {{ if not $orderByWeight }}
            {{ range (.Paginate (.Pages.GroupByDate "2006")).PageGroups }}
              {{ range .Pages }}
                {{ partial "article-link/card.html" . }}
              {{ end }}
            {{ end }}
          {{ else }}
            {{ range (.Paginate (.Pages.ByWeight)).Pages }}
              {{ partial "article-link/card.html" . }}
            {{ end }}
          {{ end }}
          </section>
          {{ if $cardViewScreenWidth }}</div>{{ end }}
        {{ end }}
      {{ end }}

    {{ else }}
      {{/* No articles */}}
      <section class="mt-10 prose dark:prose-invert">
        <p class="py-8 border-t">
          <em>{{ i18n "list.no_articles" | emojify }}</em>
        </p>
      </section>
    {{ end }}

    {{ partial "pagination.html" . }}
  </div>
{{ end }}
